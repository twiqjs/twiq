<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Task - nanoui</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      margin: 20px;
    }

    h1 {
      font-size: 16px;
    }

    .controls {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
    }

    input {
      padding: 8px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    button {
      padding: 8px 12px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .add-btn {
      background-color: #333333;
      color: white;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      margin-bottom: 8px;
      background-color: white;
      border-radius: 4px;
      border: 1px solid #ddd;
    }

    li.completed {
      background-color: #e8f5e9;
    }

    .task-name {
      flex: 1;
    }

    li.completed .task-name {
      color: #888;
      text-decoration: line-through;
    }

    .task-buttons {
      display: flex;
      gap: 4px;
    }

    .complete-btn,
    .delete-btn {
      padding: 4px 8px;
      font-size: 12px;
      border: 1px solid #333333;
      background-color: white;
      color: black;
      cursor: pointer;
      border-radius: 4px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>
  <div id="app"></div>
</body>
<script type="module">
  import { tags, mount } from '../../dist/twiq.js';
  const { div, h1, input, button, ul, li, span } = tags;

  let tasks = [];
  let taskId = 0;
  let inputValue = '';

  const controls = () =>
    div({ class: 'controls' },
      input({
        id: 'task-input',
        type: 'text',
        placeholder: 'Task...',
        value: inputValue,
        onInput: (e) => {
          inputValue = e.target.value;
        }
      }),
      button({
        class: 'add-btn',
        onClick: () => addTask()
      }, 'Add')
    );

  const taskList = (taskArray) =>
    taskArray.map(task =>
      li({ class: task.completed ? 'completed' : '' },
        span({ class: 'task-name' }, task.name),
        div({ class: 'task-buttons' },
          button({
            class: `complete-btn ${task.completed ? 'hidden' : ''}`,
            onClick: () => completeTask(task.id)
          }, 'Complete'),
          button({
            class: 'delete-btn',
            onClick: () => deleteTask(task.id)
          }, 'Delete')
        )
      )
    );

  const addTask = () => {
    const name = inputValue.trim();
    if (!name) return;
    tasks = [...tasks, { id: ++taskId, name, completed: false }];
    inputValue = '';
    mount('controls-container', controls());
    mount('task-list-container', ...taskList(tasks));
  };

  const completeTask = (id) => {
    tasks = tasks.map(t => t.id === id ? { ...t, completed: true } : t);
    mount('task-list-container', ...taskList(tasks));
  };

  const deleteTask = (id) => {
    tasks = tasks.filter(t => t.id !== id);
    mount('task-list-container', ...taskList(tasks));
  };

  const app = () => div({},
    h1({}, 'TASK'),
    div({ id: 'controls-container' }, controls()),
    div({}, ul({ id: 'task-list-container' }, ...taskList(tasks))),
  );

  mount('app', app());

</script>

</html>